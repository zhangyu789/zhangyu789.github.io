<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D 汽车展示 - 地面更近</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000000;
        }
        canvas {
            display: block;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
        }
        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 10;
        }
        .color-btn {
            width: 30px;
            height: 30px;
            margin: 5px;
            border: none;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="info">加载中...</div>
    <div id="controls">
        <button class="color-btn" style="background-color: #ff4444" onclick="changeColor(0xff4444)"></button>
        <button class="color-btn" style="background-color: #4444ff" onclick="changeColor(0x4444ff)"></button>
        <button class="color-btn" style="background-color: #44ff44" onclick="changeColor(0x44ff44)"></button>
    </div>
    
    <script src="https://unpkg.com/three@0.134.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/three@0.134.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://unpkg.com/three@0.134.0/examples/js/loaders/DRACOLoader.js"></script>
    
    <script>
        if (typeof THREE === 'undefined') {
            document.getElementById('info').innerHTML = 'Three.js 加载失败，请检查网络连接';
            throw new Error('Three.js not loaded');
        }

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        
        // 添加光源
        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);
        
        // 配置 GLTFLoader 和 DRACOLoader
        const loader = new THREE.GLTFLoader();
        const dracoLoader = new THREE.DRACOLoader();
        dracoLoader.setDecoderPath('https://unpkg.com/three@0.134.0/examples/js/libs/draco/');
        loader.setDRACOLoader(dracoLoader);
        
        let car; // 全局变量保存汽车模型
        
        // 加载汽车模型
        loader.load(
            'https://threejs.org/examples/models/gltf/ferrari.glb',
            (gltf) => {
                car = gltf.scene;
                scene.add(car);
                
                car.scale.set(1.5, 1.5, 1.5);
                car.position.set(0, -1, 0);
                car.rotation.y = 0;
                
                document.getElementById('info').innerHTML = '汽车模型加载成功！左键旋转，右键平移，滚轮缩放';
            },
            (xhr) => {
                document.getElementById('info').innerHTML = `加载进度: ${Math.round(xhr.loaded / xhr.total * 100)}%`;
            },
            (error) => {
                document.getElementById('info').innerHTML = `模型加载失败: ${error.message}`;
                console.error('加载错误:', error);
            }
        );
        
        // 添加地面（更靠近汽车）
        const groundGeometry = new THREE.PlaneGeometry(20, 20);
        const groundMaterial = new THREE.MeshPhongMaterial({
            color: 0x333333,
            specular: 0x111111,
            shininess: 10
        });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -1.25; // 从 -2.5 改为 -2.25，更靠近汽车底部
        scene.add(ground);
        
        // 颜色切换功能
        window.changeColor = function(color) {
            if (car) {
                car.traverse((child) => {
                    if (child.isMesh && child.material) {
                        child.material.color.setHex(color);
                    }
                });
            }
        };
        
        // 动态特效 - 线条从车尾到车头
        const lineCount = 20;
        const lines = [];
        const lineMaterial = new THREE.MeshBasicMaterial({
            color: 0xaaaaaa,
            transparent: true,
            opacity: 0.8
        });
        
        for (let i = 0; i < lineCount; i++) {
            const geometry = new THREE.CylinderGeometry(0.002, 0.002, 1, 8);
            const line = new THREE.Mesh(geometry, lineMaterial);
            line.position.set(
                (Math.random() - 0.5) * 2,
                (Math.random() - 0.5) * 2,
                -5
            );
            line.scale.z = 3;
            line.rotation.x = Math.PI / 2;
            lines.push({
                object: line,
                velocity: 0.2 + Math.random() * 0.1
            });
            if (car) car.add(line);
        }
        
        if (car) {
            lines.forEach(line => car.add(line.object));
        } else {
            scene.add(...lines.map(l => l.object));
            loader.load('...', () => car && lines.forEach(line => car.add(line.object)));
        }
        
        camera.position.set(0, 2, 5);
        
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.rotateSpeed = 1.0;
        controls.enableZoom = true;
        controls.enablePan = true;
        controls.minDistance = 2;
        controls.maxDistance = 10;
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        function animate() {
            requestAnimationFrame(animate);
            
            // 更新线条位置和长度
            lines.forEach(line => {
                line.object.position.z += line.velocity;
                
                if (line.object.position.z > 4) {
                    line.object.position.set(
                        (Math.random() - 0.5) * 2,
                        (Math.random() - 0.5) * 2,
                        -5
                    );
                    line.object.scale.z = 3;
                } else {
                    line.object.scale.z = Math.max(3, 3 + (line.object.position.z + 5) * 0.5);
                }
            });
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        try {
            animate();
        } catch (error) {
            document.getElementById('info').innerHTML = '渲染出错: ' + error.message;
            console.error(error);
        }
    </script>
</body>
</html>
